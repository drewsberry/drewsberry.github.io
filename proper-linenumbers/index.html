<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Proper line numbers with Jekyll &middot; Drew Silcock
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/stylesheets.css">

  <!-- Google Font -->
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/media/site/apple-touch-icon.png">
  <link rel="shortcut icon" href="/public/media/site/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52653050-1', 'auto');
  ga('send', 'pageview');

</script>


  <body class="theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Maybe somebody, somewhere will find this useful.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/download/">Download</a>
        
      
    
      
        
      
    
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/drewsberry">GitHub Profile</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Drew Silcock</a>
            <small>Nebulous thoughts</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Proper line numbers with Jekyll</h1>
  <span class="post-meta">
      <span class="post-date">
          18 Jul 2014
      </span>
      <div class="post-meta-separator">
          &#x2016;
      </div>
      <span class="post-categories">
          <a href="/archive/#coding">
              Coding
          </a>
      </span>
  </span>
  <p>By default, Jekyll uses the (excellent) Pygments syntax highlighter for code blocks. While this works well, the line numbers it produces are less than satisfactory.</p>

<p>Here’s the default <code>lineno</code> option, <code>inline</code>:</p>

<p><img src="/public/media/proper-linenumbers/lineno_w_inline.png" alt="lineno=inline" /></p>

<p>This works, but has two main visual and practical problems:
1. There is no visual separation between the line numbers and the code, causing them to visually become indistinct, and
2. When trying to copy code from the codeblocks, the line numbers are included, annoyingly.</p>

<p>So what’s the alternative? <!--more--> </p>

<p>Well, Pygments has inbuilt the <code>table</code> option, which separates the code from the linenumbers, ostensibly fixing both of these problems. Let’s take a look:</p>

<p><img src="/public/media/proper-linenumbers/lineno_w_table.png" alt="lineno=table" /></p>

<p>Well, as you can see, this doesn’t really look good either. The main problems are:
1. The size of the line number table is inconsistent between codeblocks, and
2. The line numbers don’t align with the actual lines of code</p>

<p>So let’s get rid of the <code>lineno</code> option altogether, and get our beautiful but functional line numbers through <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Counters">CSS counters</a>, as described in an article by <a href="http://alexpeattie.com/blog/github-style-syntax-highlighting-with-pygments/">Alex Peattie</a>.</p>

<h2 id="css-file">CSS File</h2>

<p>Alex’s CSS is as follows:</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><a name="True-1"></a><span class="n">pre</span> <span class="p">{</span>
<a name="True-2"></a>    <span class="n">counter</span><span class="o">-</span><span class="nl">reset</span><span class="p">:</span> <span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">;</span>
<a name="True-3"></a>    <span class="nl">border</span><span class="p">:</span> <span class="n">solid</span> <span class="mi">1</span><span class="n">px</span> <span class="err">#</span><span class="n">d9d9d9</span><span class="p">;</span>
<a name="True-4"></a>    <span class="n">border</span><span class="o">-</span><span class="nl">radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a name="True-5"></a>    <span class="nl">background</span><span class="p">:</span> <span class="err">#</span><span class="n">fff</span><span class="p">;</span>
<a name="True-6"></a>    <span class="nl">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a name="True-7"></a>    <span class="n">line</span><span class="o">-</span><span class="nl">height</span><span class="p">:</span> <span class="mi">23</span><span class="n">px</span><span class="p">;</span>
<a name="True-8"></a>    <span class="n">margin</span><span class="o">-</span><span class="nl">bottom</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
<a name="True-9"></a>    <span class="n">white</span><span class="o">-</span><span class="nl">space</span><span class="p">:</span> <span class="n">pre</span><span class="p">;</span>
<a name="True-10"></a>    <span class="n">overflow</span><span class="o">-</span><span class="nl">x</span><span class="p">:</span> <span class="k">auto</span><span class="p">;</span>
<a name="True-11"></a>    <span class="n">word</span><span class="o">-</span><span class="k">break</span><span class="o">:</span> <span class="n">inherit</span><span class="p">;</span>
<a name="True-12"></a>    <span class="n">word</span><span class="o">-</span><span class="nl">wrap</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<a name="True-13"></a><span class="p">}</span>
<a name="True-14"></a>
<a name="True-15"></a><span class="n">pre</span> <span class="n">a</span><span class="o">::</span><span class="n">before</span> <span class="p">{</span>
<a name="True-16"></a>  <span class="nl">content</span><span class="p">:</span> <span class="n">counter</span><span class="p">(</span><span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">);</span>
<a name="True-17"></a>  <span class="n">counter</span><span class="o">-</span><span class="nl">increment</span><span class="p">:</span> <span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">;</span>
<a name="True-18"></a>  <span class="n">padding</span><span class="o">-</span><span class="nl">right</span><span class="p">:</span> <span class="mi">1</span><span class="n">em</span><span class="p">;</span> <span class="cm">/* space after numbers */</span>
<a name="True-19"></a>  <span class="nl">width</span><span class="p">:</span> <span class="mi">25</span><span class="n">px</span><span class="p">;</span>
<a name="True-20"></a>  <span class="n">text</span><span class="o">-</span><span class="nl">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<a name="True-21"></a>  <span class="nl">opacity</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">;</span>
<a name="True-22"></a>  <span class="nl">display</span><span class="p">:</span> <span class="kr">inline</span><span class="o">-</span><span class="n">block</span><span class="p">;</span>
<a name="True-23"></a>  <span class="nl">color</span><span class="p">:</span> <span class="err">#</span><span class="n">aaa</span><span class="p">;</span>
<a name="True-24"></a>  <span class="nl">background</span><span class="p">:</span> <span class="err">#</span><span class="n">eee</span><span class="p">;</span>
<a name="True-25"></a>  <span class="n">margin</span><span class="o">-</span><span class="nl">right</span><span class="p">:</span> <span class="mi">16</span><span class="n">px</span><span class="p">;</span>
<a name="True-26"></a>  <span class="nl">padding</span><span class="p">:</span> <span class="mi">2</span><span class="n">px</span> <span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<a name="True-27"></a>  <span class="n">font</span><span class="o">-</span><span class="nl">size</span><span class="p">:</span> <span class="mi">13</span><span class="n">px</span><span class="p">;</span>
<a name="True-28"></a>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">touch</span><span class="o">-</span><span class="nl">callout</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-29"></a>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-30"></a>  <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-31"></a>  <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-32"></a>  <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-33"></a>  <span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-34"></a><span class="p">}</span>
<a name="True-35"></a>
<a name="True-36"></a><span class="n">pre</span> <span class="nl">a</span><span class="p">:</span><span class="n">first</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">type</span><span class="o">::</span><span class="n">before</span> <span class="p">{</span>
<a name="True-37"></a>  <span class="n">padding</span><span class="o">-</span><span class="nl">top</span><span class="p">:</span> <span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<a name="True-38"></a><span class="p">}</span>
<a name="True-39"></a>
<a name="True-40"></a><span class="n">pre</span> <span class="nl">a</span><span class="p">:</span><span class="n">last</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">type</span><span class="o">::</span><span class="n">before</span> <span class="p">{</span>
<a name="True-41"></a>  <span class="n">padding</span><span class="o">-</span><span class="nl">bottom</span><span class="p">:</span> <span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<a name="True-42"></a><span class="p">}</span>
<a name="True-43"></a>
<a name="True-44"></a><span class="n">pre</span> <span class="nl">a</span><span class="p">:</span><span class="n">only</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">type</span><span class="o">::</span><span class="n">before</span> <span class="p">{</span>
<a name="True-45"></a>  <span class="nl">padding</span><span class="p">:</span> <span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<a name="True-46"></a><span class="p">}</span></code></pre></div>

<p>Here’s what it produces after adding it to your <code>syntax.css</code>:</p>

<p><img src="/public/media/proper-linenumbers/lineno_beautiful.png" alt="beautiful linenumbers" /></p>

<p>Note those important lines at the end of <code>pre a::before</code>:</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><a name="True-1"></a><span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">touch</span><span class="o">-</span><span class="nl">callout</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-2"></a>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-3"></a>  <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-4"></a>  <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-5"></a>  <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a name="True-6"></a>  <span class="n">user</span><span class="o">-</span><span class="nl">select</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span></code></pre></div>

<p>This tell the browser to ignore the line numbers when copying, solving one of our initial problems.</p>

<p>In addition, the background grey of <code>#eee</code> gives the visual distinction between line numbers and code that we were lacking from <code>lineno=inline</code>. And, of course, they align properly with the actual lines of code, unlike <code>lineno=table</code>.</p>

<p>On top of this, the <code>padding</code> gives the line numbers a consistent spacing and the solid border given by <code>border: solid 1px #d9d9d9;</code> gives the code a clear separation from the main text.</p>

<h2 id="lineanchors">Lineanchors</h2>

<p>It’s not quite that simple, though. These CSS counters need the <code>lineanchors</code> option to be given for each codeblock, or it ends up looking like this:</p>

<p><img src="/public/media/proper-linenumbers/lineno_wo_lineanchors.png" alt="without lineanchors" /></p>

<p>To solve this, you can either just put <code>lineanchors</code> in every <code>highlight</code> Liquid tag, which is a bit annoying and can easily be forgotten, or you can use a global plugin to allow you to specify global Pygments options in your <code>_config.yml</code>. Such a plugin is available <a href="https://gist.github.com/danasilver/8121699">here</a>, thanks to <a href="https://github.com/danasilver">Dana Silver</a>.</p>

<p>Using this plugin, you can simply specify as follows in your <code>_config.yml</code>:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><a name="True-1"></a><span class="l-Scalar-Plain">pygments_options</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&#39;lineanchors&#39;</span><span class="p-Indicator">]</span></code></pre></div>

<p>Then you don’t need to put it in each codeblock tag and can forget about it!</p>

<p>Unfortuantely, GitHub Pages doesn’t allow for custom Jekyll plugins for security reasons, so unless you want to build the site locally and push the resulting html, you’re gonna have to stick to putting <code>lineanchors</code> in each tag. Up to you which you want to do.</p>

<h2 id="scroll-bar">Scroll bar</h2>

<p>Another problem I had, although I am unsure whether this problem is universal/reproducible, is that an annoying y-scroll bar appeared, even when there was no need for it. This is what it looked like:</p>

<p><img src="/public/media/proper-linenumbers/lineno_w_yscroll.png" alt="annoying scroll bar" /></p>

<p>Now, I haven’t come all this way just to be bested by an annoying y-scroll bar, so I added in this bit of CSS to Alex’s code to get rid of it:</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><a name="True-1"></a><span class="cm">/* In pre { .. } */</span>
<a name="True-2"></a><span class="n">overflow</span><span class="o">-</span><span class="nl">y</span><span class="p">:</span> <span class="n">hidden</span><span class="p">;</span></code></pre></div>

<p>This is placed in <code>pre { .. }</code>, just after <code>overflow-x: auto;</code>.</p>

<p>After this, I finally had the beautiful line numbers that Pygments natively lacks.</p>

<p><strong>Update:</strong> <em>5-8-14</em></p>

<p>Dana’s global configs Jekyll plugin is incompatible with the new Jekyll 2.2.0 release which both I and GitHub Pages are now using. So it looks like until I get round to sorting out why the plugin is incompatible, you’ll need to actually type <code>highlight lang lineanchors</code> for each individual code block. Annoying.</p>

<p>I always forget to do this, and could not be bothered to go through each codeblock in each blog post I’ve written, so here’s a simple bash script to replace all instances of the <code>highlight lang</code> Liquid tag with its <code>lineanchors</code> equivalent:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><a name="True-1"></a><span class="c">#!/bin/bash</span>
<a name="True-2"></a>
<a name="True-3"></a><span class="c"># Adds lineanchors option to all codeblock Liquid tags</span>
<a name="True-4"></a>
<a name="True-5"></a><span class="nv">languages</span><span class="o">=(</span> vim python perl ruby yaml css html bash cpp c <span class="o">)</span>
<a name="True-6"></a><span class="nv">posts</span><span class="o">=</span><span class="s2">&quot;path/to/posts&quot;</span>
<a name="True-7"></a>
<a name="True-8"></a><span class="k">for</span> lang in <span class="s2">&quot;${languages[@]}&quot;</span>
<a name="True-9"></a><span class="k">do</span>
<a name="True-10"></a>    :
<a name="True-11"></a>    perl -pi -e <span class="s2">&quot;s/highlight $lang/highlight $lang lineanchors/g&quot;</span> <span class="nv">$posts</span>
<a name="True-12"></a><span class="k">done</span></code></pre></div>

<p>Change <code>$posts</code> to correspond to the location of your blog posts, the contents of which you wish to replace. If you’re using more lexers, just add them into the languages array.</p>


</div>

<hr>
<p><form action="/">
  <button class="btn btn-default btn-lg" href="/">
      Back to home...
  </button>
</form></p>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/using-make-and-latexmk">
            Using make and latexmk for easy LaTeX compilation
            <small>23 Sep 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/calculating-overlap">
            Calculating the overlap of aerial photos
            <small>31 Jul 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/custom-jekyll-plugins">
            Custom Jekyll plugins with GitHub Pages
            <small>29 Jul 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>



    <!-- Message inviting everyone to comment -->
    <div class="discuss">
        If you liked this post, have any questions or fancy having a good discussion, please leave a comment below, or 
        <a href = "mailto:drewATdrewsilcockDOTcoDOTuk" 
           onclick = "this.href=this.href
                      .replace(/AT/,'&#64;')
                      .replace(/DOT/,'&#46;')
                      .replace(/DOT/,'&#46;')"
        >send me an email.</a>
    </div>

    <!-- Add Disqus comments -->
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'drewsilcock'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
 


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

  </body>

</html>

