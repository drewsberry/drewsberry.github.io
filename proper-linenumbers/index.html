<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Proper line numbers with Jekyll &middot; Drew Silcock
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/bootstrap_button.css">

  <!-- CDNs-->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/media/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/media/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52653050-1', 'auto');
  ga('send', 'pageview');

</script>

  <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Drew Silcock
        </a>
      </h1>
      <p class="lead">Maybe somebody, somewhere will find this useful.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/download/">Download</a>
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/drewsberry/drewsberry.github.io">GitHub project</a>
      <span class="sidebar-nav-item">Currently v1.0.3</span>
    </nav>

    <p>&copy; 2014. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Proper line numbers with Jekyll</h1>
  <span class="post-date">18 Jul 2014</span>
  <p>By default, Jekyll uses the (excellent) Pygments syntax highlighter for code blocks. While this works well, the line numbers it produces are less than satisfactory.</p>

<p>Here’s the default <code>lineno</code> option, <code>inline</code>:</p>

<p><img src="../public/media/lineno_w_inline.png" alt="lineno=inline" /></p>

<p>This works, but has two main visual and practical problems:
    * There is no visual separation between the line numbers and the code, causing them to visually become indistinct, and
    * When trying to copy code from the codeblocks, the line numbers are included, annoyingly.</p>

<p>So what’s the alternative? <!--more--> Well, Pygments has inbuilt the <code>table</code> option, which separates the code from the linenumbers, ostensibly fixing both of these problems. Let’s take a look:</p>

<p><img src="../public/media/lineno_w_table.png" alt="lineno=table" /></p>

<p>Well, as you can see, this doesn’t really look good either. The main problems areL=:
    * The size of the line number table is inconsistent between codeblocks, and
    * The line numbers don’t align with the actual lines of code</p>

<p>So let’s get rid of the <code>lineno</code> option altogether, and get our beautiful but functional line numbers through <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Counters">CSS counters</a>, as described in an article by <a href="http://alexpeattie.com/blog/github-style-syntax-highlighting-with-pygments/">Alex Peattie</a>.</p>

<h2 id="css-file">CSS File</h2>

<p>Alex’s CSS is as follows:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">pre</span> <span class="p">{</span>
    <span class="k">counter-reset</span><span class="o">:</span> <span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="k">solid</span> <span class="m">1px</span> <span class="m">#d9d9d9</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">line-height</span><span class="o">:</span> <span class="m">23px</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
    <span class="k">white-space</span><span class="o">:</span> <span class="n">pre</span><span class="p">;</span>
    <span class="k">overflow-x</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
    <span class="n">word</span><span class="o">-</span><span class="n">break</span><span class="o">:</span> <span class="k">inherit</span><span class="p">;</span>
    <span class="n">word</span><span class="o">-</span><span class="n">wrap</span><span class="o">:</span> <span class="k">inherit</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">pre</span> <span class="nt">a</span><span class="o">:</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="k">content</span><span class="o">:</span> <span class="n">counter</span><span class="p">(</span><span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">);</span>
  <span class="k">counter-increment</span><span class="o">:</span> <span class="n">line</span><span class="o">-</span><span class="n">numbering</span><span class="p">;</span>
  <span class="k">padding-right</span><span class="o">:</span> <span class="m">1em</span><span class="p">;</span> <span class="c">/* space after numbers */</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">25px</span><span class="p">;</span>
  <span class="k">text-align</span><span class="o">:</span> <span class="k">right</span><span class="p">;</span>
  <span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">7</span><span class="p">;</span>
  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#aaa</span><span class="p">;</span>
  <span class="k">background</span><span class="o">:</span> <span class="m">#eee</span><span class="p">;</span>
  <span class="k">margin-right</span><span class="o">:</span> <span class="m">16px</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">2px</span> <span class="m">10px</span><span class="p">;</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">13px</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">touch</span><span class="o">-</span><span class="n">callout</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">pre</span> <span class="nt">a</span><span class="nd">:first-of-type</span><span class="o">:</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="k">padding-top</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">pre</span> <span class="nt">a</span><span class="nd">:last-of-type</span><span class="o">:</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">pre</span> <span class="nt">a</span><span class="nd">:only-of-type</span><span class="o">:</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>Here’s what it produces after adding it to your <code>syntax.css</code>:</p>

<p><img src="../public/media/lineno_beautiful.png" alt="beautiful linenumbers" /></p>

<p>Note those important lines at the end of <code>pre a::before</code>:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">-webkit-touch-callout</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span>
  <span class="nt">-webkit-user-select</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span>
  <span class="nt">-khtml-user-select</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span>
  <span class="nt">-moz-user-select</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span>
  <span class="nt">-ms-user-select</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span>
  <span class="nt">user-select</span><span class="o">:</span> <span class="nt">none</span><span class="o">;</span></code></pre></div>

<p>This tell the browser to ignore the line numbers when copying, solving one of our initial problems.</p>

<p>In addition, the background grey of <code>#eee</code> gives the visual distinction between line numbers and code that we were lacking from <code>lineno=inline</code>. And, of course, they align properly with the actual lines of code, unlike <code>lineno=table</code>.</p>

<p>On top of this, the <code>padding</code> gives the line numbers a consistent spacing and the solid border given by <code>border: solid 1px #d9d9d9;</code> gives the code a clear separation from the main text.</p>

<h2 id="lineanchors">Lineanchors</h2>

<p>It’s not quite that simple, though. These CSS counters need the <code>lineanchors</code> option to be given for each codeblock, or it ends up looking like this:</p>

<p><img src="../public/media/lineno_wo_lineanchors.png" alt="without lineanchors" /></p>

<p>To solve this, you can either just put <code>lineanchors</code> in every <code>highlight</code> Liquid tag, which is a bit annoying and can easily be forgotten, or you can use a global plugin to allow you to specify global Pygments options in your <code>_config.yml</code>. Such a plugin is available <a href="https://gist.github.com/danasilver/8121699">here</a>, thanks to <a href="https://github.com/danasilver">Dana Silver</a>.</p>

<p>Using this plugin, you can simply specify as follows in your <code>_config.yml</code>:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">pygments_options</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&#39;lineanchors&#39;</span><span class="p-Indicator">]</span></code></pre></div>

<p>Then you don’t need to put it in each codeblock tag and can forget about it!</p>

<p>Unfortuantely, GitHub Pages doesn’t allow for custom Jekyll plugins for security reasons, so unless you want to build the site locally and push the resulting html, you’re gonna have to stick to putting <code>lineanchors</code> in each tag. Up to you which you want to do.</p>

<h2 id="scroll-bar">Scroll bar</h2>

<p>Another problem I had, although I am unsure whether this problem is universal/reproducible, is that an annoying y-scroll bar appeared, even when there was no need for it. This is what it looked like:</p>

<p><img src="../public/media/lineno_w_yscroll.png" alt="annoying scroll bar" /></p>

<p>Now, I haven’t come all this way just to be bested by an annoying y-scroll bar, so I added in this bit of CSS to Alex’s code to get rid of it:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* In pre { .. } */</span>
<span class="nt">overflow-y</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span></code></pre></div>

<p>This is placed in <code>pre { .. }</code>, just after <code>overflow-x: auto;</code>.</p>

<p>After this, I finally had the beautiful line numbers that Pygments natively lacks.</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/custom-jekyll-plugins">
            Custom Jekyll plugins with GitHub Pages
            <small>29 Jul 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/meters-per-pixel">
            Calculating meters per pixel from aerial photographs
            <small>21 Jul 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/personal-cheatsheet">
            Personal cheatsheet
            <small>15 Jul 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>



    <!-- Message inviting everyone to comment -->
    <div class="discuss">
        If you liked this post, have any questions or fancy having a good discussion, please leave a comment below, or 
        <a href = "mailto:drewATdrewsilcockDOTcoDOTuk" 
           onclick = "this.href=this.href
                      .replace(/AT/,'&#64;')
                      .replace(/DOT/,'&#46;')
                      .replace(/DOT/,'&#46;')"
        >send me an email.</a>
    </div>

    <!-- Add Disqus comments -->
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'drewsilcock'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
 


    </div>

  </body>

</html>

